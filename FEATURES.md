# WithTheLake - 페이지별 기능 명세서 (FEATURES.md)

이 문서는 위드더레이크 웹 플랫폼의 각 페이지별 상세 기능을 정리한 명세서입니다.
권한별 동작 차이, 조건부 UI, 특수 기능 등을 기록합니다.

**관련 문서**:
- `CLAUDE.md` - 프로젝트 규칙 및 개발 가이드
- `PLAN.md` - 프로젝트 계획서 (Phase별 개발 진행)
- `DEVLOG.md` - 개발 과정 기록 (문제 해결 사례)

---

## 목차

1. [권한 체계](#1-권한-체계)
2. [마이페이지 (Service)](#2-마이페이지-service)
3. [힐링로드ON (Service)](#3-힐링로드on-service)
4. [커뮤니티 게시판 (Marketing)](#4-커뮤니티-게시판-marketing)
5. [로그인/회원가입](#5-로그인회원가입)
6. [스토어 (Marketing)](#6-스토어-marketing)
7. [뉴스 (Marketing)](#7-뉴스-marketing)
8. [기타 마케팅 페이지](#8-기타-마케팅-페이지)
9. [공용 컴포넌트](#9-공용-컴포넌트)
10. [권한 요약 테이블](#10-권한-요약-테이블)

---

## 1. 권한 체계

### 1.1 3가지 권한 레벨

| 레벨 | 식별 방법 | 설명 |
|------|----------|------|
| **비로그인 (Guest)** | `user === null` | 인증되지 않은 방문자 |
| **로그인 (User)** | `user !== null` | 카카오 OAuth로 인증된 사용자 |
| **관리자 (Admin)** | `user_profiles.is_admin === true` | 관리자 권한이 부여된 사용자 |

### 1.2 권한 체크 함수

```typescript
// 서버사이드 인증 체크
import { checkAuthStatus, checkIsAdmin } from '@/actions/profileActions'

const authStatus = await checkAuthStatus()  // { isAuthenticated: boolean, user: User | null }
const isAdmin = await checkIsAdmin()        // boolean
```

### 1.3 권한별 제약 요약

#### 비로그인 (Guest)
- ❌ 감정 기록 불가
- ❌ 게시글/댓글 작성 불가
- ❌ 마이페이지 설정/기록 접근 불가
- ✅ 콘텐츠 조회 가능 (게시글, 오디오, 스토어, 뉴스)

#### 로그인 (User)
- ✅ 감정 기록 (일 1회)
- ✅ 게시글/댓글 작성
- ✅ 자신의 글/댓글 수정/삭제
- ❌ 다른 사용자 콘텐츠 삭제 불가
- ❌ 고정글 설정 불가

#### 관리자 (Admin)
- ✅ 로그인 사용자의 모든 권한
- ✅ 다른 사용자 글/댓글 삭제
- ✅ 고정글 설정/해제
- ✅ 관리자 전용 UI 표시 (테스트 버튼 등)

---

## 2. 마이페이지 (Service)

### 2.1 페이지 경로

| 경로 | 설명 | 파일 |
|------|------|------|
| `/mypage` | 마이페이지 메인 | `app/(service)/mypage/page.tsx` |
| `/mypage/settings` | 설정 | `app/(service)/mypage/settings/page.tsx` |
| `/mypage/records` | 감정 기록 목록 | `app/(service)/mypage/records/page.tsx` |

### 2.2 `/mypage` 메인 페이지

#### 접근 권한
| 권한 | 접근 | 동작 |
|------|------|------|
| 비로그인 | ✅ | 로그인 유도 UI 표시 |
| 로그인 | ✅ | 풀 기능 접근 |
| 관리자 | ✅ | 풀 기능 + 관리자 전용 버튼 |

#### UI 요소별 권한

| UI 요소 | 비로그인 | 로그인 | 관리자 | 비고 |
|---------|---------|--------|--------|------|
| 로그인 유도 섹션 | ✅ 표시 | ❌ 숨김 | ❌ 숨김 | 카카오 로그인 버튼 |
| 사용자 정보 (닉네임, 이메일) | ❌ | ✅ | ✅ | - |
| 설정 버튼 (톱니) | ❌ | ✅ | ✅ | `/mypage/settings`로 이동 |
| 로그아웃 버튼 | ❌ | ✅ | ✅ | - |
| 감정 기록 통계 | ❌ | ✅ | ✅ | 총 기록, 이번주, 자주 느끼는 감정 |
| 최근 감정 기록 (5개) | ❌ | ✅ | ✅ | - |
| **주간 감정 보고서 버튼** | ❌ | ✅ | ✅ | 보고서 모달 열기 |
| **이번 주 보고서 (테스트) 버튼** | ❌ | ❌ | ✅ | **관리자 전용** |
| 힐링로드ON 시작하기 버튼 | ❌ | ✅ | ✅ | `/healing`으로 이동 |

#### 주간 감정 보고서 기능

**보고서 보기 버튼** (파란색):
- 권한: 로그인 사용자 모두
- 동작: 지난 주 월~일 데이터 기반 보고서 표시
- AI 인사이트 포함 (OpenAI gpt-4o-mini)

**이번 주 보고서 (테스트) 버튼** (주황색/앰버):
- 권한: **관리자 전용**
- 동작: 이번 주 월~일(현재까지) 데이터 기반 테스트 보고서
- 테스트 배너 표시 ("이 보고서는 저장되지 않습니다")
- 구현: `MypageClient.tsx`에서 `isAdmin` 체크

```typescript
// MypageClient.tsx
{isAdmin && (
  <button onClick={() => setViewMode('thisWeek')}>
    이번 주 보고서 (테스트)
  </button>
)}
```

### 2.3 `/mypage/settings` 설정 페이지

#### 접근 권한
| 권한 | 접근 | 동작 |
|------|------|------|
| 비로그인 | ❌ | `/login?next=/mypage/settings` 리다이렉트 |
| 로그인 | ✅ | 풀 접근 |
| 관리자 | ✅ | 풀 접근 |

#### 기능
- 닉네임 변경 (예정)
- 연령대 선택 (예정)
- 알림 설정 (예정)

### 2.4 `/mypage/records` 기록 페이지

#### 접근 권한
| 권한 | 접근 | 동작 |
|------|------|------|
| 비로그인 | ❌ | `/login?next=/mypage/records` 리다이렉트 |
| 로그인 | ✅ | 본인 기록만 조회 |
| 관리자 | ✅ | 본인 기록만 조회 |

#### 기능
- 감정 기록 목록 (페이지네이션, 20개/페이지)
- 날짜별 그룹핑
- 기록 상세 보기

---

## 3. 힐링로드ON (Service)

### 3.1 페이지 경로

| 경로 | 설명 | 파일 |
|------|------|------|
| `/healing` | 힐링로드ON 메인 | `app/(service)/healing/page.tsx` |

### 3.2 접근 권한
- ✅ 누구나 접근 가능 (비로그인 포함)

### 3.3 기능별 권한

| 기능 | 비로그인 | 로그인 | 관리자 | 비고 |
|------|---------|--------|--------|------|
| 오디오 재생 | ✅ | ✅ | ✅ | 제한 없음 |
| 걷기 안내 모달 | ✅ | ✅ | ✅ | 12개 코스 |
| 긍정확언 모달 | ✅ | ✅ | ✅ | 9개 메시지 |
| 길 안내 (텍스트) | ✅ | ✅ | ✅ | 지역 선택 |
| 길 안내 (지도) | ✅ | ✅ | ✅ | GPS 연동 |
| 오디오 상세보기 | ✅ | ✅ | ✅ | - |
| **오늘 감정 기록** | ❌ | ✅ (1일 1회) | ✅ (1일 1회) | 아래 상세 참조 |
| 설문조사 | ✅ | ✅ | ✅ | 구글 폼 링크 |
| 스토어 배너 | ✅ | ✅ | ✅ | 네이버 스토어 링크 |

### 3.4 오늘 감정 기록 버튼 동작

```typescript
// HealingPageClient.tsx
const handleEmotionRecord = async () => {
  // 1. 비로그인 체크
  if (!user) {
    setShowLoginModal(true)
    return
  }

  // 2. 오늘 기록 여부 체크
  const result = await checkTodayEmotionRecord()
  if (result.hasRecorded) {
    setShowAlreadyRecordedModal(true)
    return
  }

  // 3. 감정 기록 모달 열기
  setShowEmotionRecordModal(true)
}
```

| 상태 | 클릭 시 동작 |
|------|-------------|
| 비로그인 | 로그인 모달 표시 |
| 로그인 + 오늘 이미 기록 | "이미 오늘 기록했습니다" 안내 모달 |
| 로그인 + 오늘 미기록 | 감정 기록 모달 (5단계 멀티스텝) |

### 3.5 오디오 플레이어 UI

| 상태 | 표시 내용 |
|------|----------|
| 오디오 미선택 | 플레이스홀더 ("오디오를 선택해주세요") |
| 오디오 선택됨 | 미디어 제어 박스 (제목, 설명, 진행 바, 버튼) |
| 로딩 중 | 로딩 스피너 |
| 에러 | 에러 메시지 토스트 |

---

## 4. 커뮤니티 게시판 (Marketing)

### 4.1 페이지 경로

| 게시판 | 리스트 | 작성 | 상세 |
|--------|--------|------|------|
| 공지사항 | `/community/notice` | `/community/notice/write` | `/community/notice/{id}` |
| 자유게시판 | `/community/free` | `/community/free/write` | `/community/free/{id}` |
| 이벤트 | `/community/event` | `/community/event/write` | `/community/event/{id}` |
| 힐링 후기 | `/community/review` | `/community/review/write` | `/community/review/{id}` |

### 4.2 게시판 리스트 페이지

#### 접근 권한
- ✅ 누구나 접근 가능

#### 기능별 권한

| 기능 | 비로그인 | 로그인 | 관리자 |
|------|---------|--------|--------|
| 게시글 목록 조회 | ✅ | ✅ | ✅ |
| 검색 (서버사이드) | ✅ | ✅ | ✅ |
| 검색 타입 필터 | ✅ | ✅ | ✅ |
| 페이지네이션 | ✅ | ✅ | ✅ |
| **글쓰기 버튼 클릭** | 로그인 모달 | 작성 페이지 이동 | 작성 페이지 이동 |

#### 게시판별 특수 기능

| 게시판 | 특수 기능 |
|--------|----------|
| 공지사항 | 댓글 없음, 에메랄드 테마 |
| 자유게시판 | 주제 필터 (잡담/질문/정보/후기), 파란색 테마 |
| 이벤트 | 갤러리 뷰 (썸네일), 이미지 업로드 |
| 힐링 후기 | 갤러리 뷰, 별점, 상품 정보, 정렬 옵션 |

#### 후기 게시판 정렬 옵션

| 정렬 | 설명 |
|------|------|
| 최신순 (기본) | `created_at DESC` |
| 평점 높은순 | `rating DESC, created_at DESC` |
| 평점 낮은순 | `rating ASC, created_at DESC` |

### 4.3 게시글 작성 페이지

#### 접근 권한
| 권한 | 접근 | 동작 |
|------|------|------|
| 비로그인 | ⚠️ | `/healing`으로 리다이렉트 |
| 로그인 | ✅ | 작성 폼 표시 |
| 관리자 | ✅ | 작성 폼 표시 |

#### 게시판별 작성 폼 필드

| 필드 | 공지사항 | 자유게시판 | 이벤트 | 후기 |
|------|---------|-----------|--------|------|
| 제목 | ✅ 필수 | ✅ 필수 | ✅ 필수 | ✅ 필수 |
| 내용 | ✅ 필수 | ✅ 필수 | ✅ 필수 | ✅ 필수 |
| 주제 선택 | ❌ | ✅ (선택) | ❌ | ❌ |
| 이미지 업로드 | ❌ | ✅ (최대 10장) | ✅ (최대 10장) | ✅ (최대 10장) |
| 별점 | ❌ | ❌ | ❌ | ✅ 필수 (1-5) |
| 상품 선택 | ❌ | ❌ | ❌ | ✅ (선택) |

#### 자동 저장 기능
- localStorage 저장 키: `community_draft_{boardType}`
- 저장 데이터: title, content, topic, images
- 저장 시점: 폼 내용 변경 시
- 삭제 시점: 글 등록 성공 시

### 4.4 게시글 상세 페이지

#### 접근 권한
- ✅ 누구나 접근 가능

#### UI 요소별 권한

| UI 요소 | 비로그인 | 로그인 (작성자) | 로그인 (타인) | 관리자 |
|---------|---------|----------------|--------------|--------|
| 게시글 내용 | ✅ | ✅ | ✅ | ✅ |
| 조회수 증가 | ✅ | ✅ | ✅ | ✅ |
| 수정 버튼 | ❌ | ✅ | ❌ | ✅ (본인 글만) |
| 삭제 버튼 | ❌ | ✅ | ❌ | ✅ (모든 글) |
| **고정/해제 버튼** | ❌ | ❌ | ❌ | ✅ |
| 목록 버튼 | ✅ | ✅ | ✅ | ✅ |
| TOP 버튼 | ✅ | ✅ | ✅ | ✅ |

#### 댓글 기능

| 기능 | 비로그인 | 로그인 (작성자) | 로그인 (타인) | 관리자 |
|------|---------|----------------|--------------|--------|
| 댓글 목록 조회 | ✅ | ✅ | ✅ | ✅ |
| 댓글 작성 | ❌ (로그인 모달) | ✅ | ✅ | ✅ |
| 댓글 삭제 | ❌ | ✅ (본인 댓글) | ❌ | ✅ (모든 댓글) |

**공지사항 특별 규칙**: 댓글 기능 완전 비활성화

#### 로그인 후 댓글 포커스
```typescript
// PostDetail.tsx
// 비로그인 상태에서 댓글 textarea 클릭 시
const handleCommentAreaClick = () => {
  if (!currentUserId) {
    setShowLoginModal(true)
    setLoginCallback(() => {
      commentInputRef.current?.focus()
    })
  }
}
```

### 4.5 관리자 기능

#### 고정글 토글
```typescript
// PostDetail.tsx (관리자 전용 버튼)
{isAdmin && (
  <button onClick={() => togglePinPost(post.id)}>
    {post.is_pinned ? '고정 해제' : '상단 고정'}
  </button>
)}
```

- 모든 게시판에서 동작
- 고정된 글은 목록 최상단에 표시
- 핀 아이콘으로 표시

#### 타인 글/댓글 삭제
- 관리자는 모든 글/댓글 삭제 가능
- 소프트 삭제 (`is_active = false`)
- RLS 정책으로 서버에서도 권한 체크

### 4.6 후기 게시판 특수 기능

#### 상품 이미지 표시 (2026-01-26 추가)

| 상황 | 카드 (32x32) | 모달 (40x40) |
|------|-------------|--------------|
| 활동 후기 | Footprints 아이콘 (보라색) | Footprints 아이콘 (보라색) |
| 제품 후기 + 이미지 있음 | 상품 이미지 | 상품 이미지 |
| 제품 후기 + 이미지 없음 | ShoppingBag 아이콘 (핑크색) | ShoppingBag 아이콘 (핑크색) |

#### 별점 표시
- 0.5 단위 지원 (반별)
- `StarRating` 컴포넌트 사용
- 작성자가 매긴 평점 표시

---

## 5. 로그인/회원가입

### 5.1 페이지 경로

| 경로 | 설명 | 파일 |
|------|------|------|
| `/login` | 로그인 | `app/login/page.tsx` |
| `/join` | 회원가입 | `app/join/page.tsx` |
| `/auth/callback` | OAuth 콜백 | `app/auth/callback/route.ts` |

### 5.2 `/login` 로그인 페이지

#### 접근 권한
| 권한 | 접근 | 동작 |
|------|------|------|
| 비로그인 | ✅ | 로그인 폼 표시 |
| 로그인 | ❌ | `/mypage` 또는 `?next` 파라미터로 리다이렉트 |
| 관리자 | ❌ | `/mypage` 또는 `?next` 파라미터로 리다이렉트 |

#### UI 요소
- 뒤로가기 버튼
- 로고/아이콘
- 카카오 로그인 버튼
- 회원가입 링크
- 둘러보기 링크 (메인으로)

#### 로그인 플로우
```
/login?next={returnUrl}
→ 카카오 OAuth
→ /auth/callback?next={returnUrl}
→ {returnUrl} 또는 /mypage
```

### 5.3 `/join` 회원가입 페이지

#### 접근 권한
| 권한 | 접근 | 동작 |
|------|------|------|
| 비로그인 | ✅ | 가입 폼 표시 |
| 로그인 | ❌ | `/mypage` 리다이렉트 |
| 관리자 | ❌ | `/mypage` 리다이렉트 |

#### UI 요소
- 뒤로가기 버튼
- 카카오 간편 가입 버튼
- 이용약관/개인정보처리방침 안내
- 로그인 링크

### 5.4 로그인 모달

여러 페이지에서 공용으로 사용되는 로그인 모달

| 트리거 | 페이지 |
|--------|--------|
| 감정 기록 버튼 | `/healing` |
| 글쓰기 버튼 | 커뮤니티 게시판 |
| 댓글 textarea 클릭 | 게시글 상세 |
| 마이페이지 로그인 유도 | `/mypage` |

---

## 6. 스토어 (Marketing)

### 6.1 페이지 경로

| 경로 | 설명 | 파일 |
|------|------|------|
| `/store` | 스토어 메인 | `app/(marketing)/store/page.tsx` |

### 6.2 접근 권한
- ✅ 누구나 접근 가능

### 6.3 기능

| 기능 | 비로그인 | 로그인 | 관리자 |
|------|---------|--------|--------|
| 상품 목록 조회 | ✅ | ✅ | ✅ |
| 카테고리 필터 | ✅ | ✅ | ✅ |
| 상품 클릭 (네이버 스토어 이동) | ✅ | ✅ | ✅ |
| 상품 추가/수정/삭제 | ❌ | ❌ | 관리자 페이지에서 |

### 6.4 카테고리
- 전체
- 케어
- 어싱
- 기록

### 6.5 상품 카드 정보
- 상품 이미지
- 상품명
- 가격 / 할인가
- 평점
- 뱃지 (베스트/인기/추천/신상품)
- 리뷰 수

---

## 7. 뉴스 (Marketing)

### 7.1 페이지 경로

| 경로 | 설명 | 파일 |
|------|------|------|
| `/news` | 뉴스 메인 | `app/(marketing)/news/page.tsx` |

### 7.2 접근 권한
- ✅ 누구나 접근 가능

### 7.3 기능

| 기능 | 비로그인 | 로그인 | 관리자 |
|------|---------|--------|--------|
| 뉴스 목록 조회 | ✅ | ✅ | ✅ |
| 카테고리 필터 | ✅ | ✅ | ✅ |
| 기사 링크 클릭 (외부 이동) | ✅ | ✅ | ✅ |
| 뉴스 추가/수정/삭제 | ❌ | ❌ | 관리자 페이지에서 |

### 7.4 카테고리
- 언론보도
- 해외자료
- 블로그
- 보도자료

### 7.5 썸네일 정책

| 카테고리 | 썸네일 | 이유 |
|----------|--------|------|
| 해외자료 | ✅ 표시 | - |
| 언론보도 | ❌ 미표시 | 저작권 이슈 |
| 블로그 | 조건부 | 이미지 있으면 표시 |
| 보도자료 | 조건부 | 이미지 있으면 표시 |

---

## 8. 기타 마케팅 페이지

### 8.1 메인 홈페이지 (`/`)

- 접근: ✅ 누구나
- 기능: 서비스 소개, CTA 버튼

### 8.2 기업 소개 (`/about`)

- 접근: ✅ 누구나
- 기능: 회사 정보, 비전/미션, 연혁

### 8.3 맨발걷기 정보 (`/info`)

- 접근: ✅ 누구나
- 기능: 맨발걷기 효과, 방법, 주의사항, FAQ

### 8.4 공지사항 (`/notice`)

> 현재 `/community/notice`로 통합됨

---

## 9. 공용 컴포넌트

### 9.1 Header

| UI 요소 | 비로그인 | 로그인 | 관리자 |
|---------|---------|--------|--------|
| 로고 | ✅ | ✅ | ✅ |
| 네비게이션 메뉴 | ✅ | ✅ | ✅ |
| 커뮤니티 드롭다운 | ✅ | ✅ | ✅ |
| **로그인 버튼** | ✅ 표시 | ❌ 숨김 | ❌ 숨김 |
| **마이페이지 버튼** | ❌ 숨김 | ✅ 표시 | ✅ 표시 |

### 9.2 Toast 알림

모든 페이지에서 사용 가능한 알림 시스템

```typescript
const { showToast } = useToast()

showToast('성공 메시지', 'success')
showToast('에러 메시지', 'error')
showToast('경고 메시지', 'warning')
showToast('정보 메시지', 'info')
```

### 9.3 로그인 모달

| Props | 설명 |
|-------|------|
| `isOpen` | 모달 표시 여부 |
| `onClose` | 닫기 콜백 |
| `onLoginSuccess` | 로그인 성공 콜백 |
| `redirectTo` | 로그인 후 리다이렉트 URL |

---

## 10. 권한 요약 테이블

### 10.1 페이지 접근 권한

| 페이지 | 비로그인 | 로그인 | 관리자 | 비고 |
|--------|---------|--------|--------|------|
| `/` | ✅ | ✅ | ✅ | - |
| `/about` | ✅ | ✅ | ✅ | - |
| `/info` | ✅ | ✅ | ✅ | - |
| `/news` | ✅ | ✅ | ✅ | - |
| `/store` | ✅ | ✅ | ✅ | - |
| `/healing` | ✅ | ✅ | ✅ | 감정기록은 로그인 필수 |
| `/mypage` | ⚠️ | ✅ | ✅ | 로그인 유도 UI |
| `/mypage/settings` | ❌ | ✅ | ✅ | 리다이렉트 |
| `/mypage/records` | ❌ | ✅ | ✅ | 리다이렉트 |
| `/community/*` | ✅ | ✅ | ✅ | 조회만 가능 |
| `/community/*/write` | ❌ | ✅ | ✅ | 리다이렉트 |
| `/login` | ✅ | ❌ | ❌ | 로그인시 리다이렉트 |
| `/join` | ✅ | ❌ | ❌ | 로그인시 리다이렉트 |

### 10.2 기능별 권한

| 기능 | 비로그인 | 로그인 | 관리자 |
|------|---------|--------|--------|
| 오디오 재생 | ✅ | ✅ | ✅ |
| 감정 기록 | ❌ | ✅ (1일 1회) | ✅ (1일 1회) |
| 게시글 작성 | ❌ | ✅ | ✅ |
| 게시글 수정 | ❌ | ✅ (본인) | ✅ (본인) |
| 게시글 삭제 | ❌ | ✅ (본인) | ✅ (전체) |
| 댓글 작성 | ❌ | ✅ | ✅ |
| 댓글 삭제 | ❌ | ✅ (본인) | ✅ (전체) |
| 고정글 설정 | ❌ | ❌ | ✅ |
| 이미지 업로드 | ❌ | ✅ | ✅ |
| 주간 보고서 보기 | ❌ | ✅ | ✅ |
| 이번 주 보고서 (테스트) | ❌ | ❌ | ✅ |

---

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-01-26 | 최초 작성 |
| 2026-01-26 | 후기 게시판 상품 이미지 표시 기능 추가 |
| 2026-01-26 | 이미지 업로드 10장 확대 반영 |

---

*마지막 업데이트: 2026-01-26*
